[tox]
skipsdist=True
envlist = clean,ansible{2.17}-py{312}-{with_constraints,without_constraints}

[testenv]
description = Run the test-suite and generate a HTML coverage report
deps =
  pytest
  pytest-cov
  ansible2.17: ansible-core>2.17,<2.18
  !ansible2.18-!ansible2.18: ansible-core
  pytest-ansible-units
  -rtest-requirements.txt
  with_constraints: -rtests/unit/constraints.txt
commands = pytest --cov-report html --cov plugins/action --cov plugins/plugin_utils --module-path={toxinidir}/plugins/modules {posargs:tests/unit/}
setenv =
    PYTHONPATH = {toxinidir}{:}{toxinidir}/plugins/modules

[testenv:clean]
deps = coverage
skip_install = true
commands = coverage erase

[testenv:complexity-report]
description = Generate a HTML complexity report in the complexity directory
deps =
  # See: https://github.com/lordmauve/flake8-html/issues/30
  flake8>=3.3.0,<5.0.0'
  flake8-html
commands = -flake8 --select C90 --max-complexity 10 --format=html --htmldir={posargs:complexity} plugins

[testenv:ansible-lint]
deps =
  ansible-lint==6.17.2
changedir = {toxinidir}
commands = 
  ansible-lint
